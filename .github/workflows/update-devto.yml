name: Update Dev.to Articles in README

on:
  schedule:
    - cron: "0 6 * * *" # minden nap 06:00 UTC
  workflow_dispatch: {} # manu√°lisan is ind√≠that√≥

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Fetch latest dev.to articles
        id: devto
        run: |
          response=$(curl -s "https://dev.to/api/articles?username=marxon&per_page=5")
          echo "json=$response" >> $GITHUB_OUTPUT

      - name: Build markdown list
        id: build
        run: |
          articles=$(echo '${{ steps.devto.outputs.json }}' | jq -r '.[] | "- [" + .title + "](" + .url + ")"')
          echo "list=$articles" >> $GITHUB_OUTPUT

      - name: Update README
        run: |
          list="${{ steps.build.outputs.list }}"

          # cser√©li a jel√∂l≈ëk k√∂z√∂tti r√©szt
          sed -i "/<!-- DEVTO-LIST:START -->/,/<!-- DEVTO-LIST:END -->/c\\<!-- DEVTO-LIST:START -->\n$list\n<!-- DEVTO-LIST:END -->" README.md

      - name: Commit changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add README.md
          git commit -m "üîÑ Update latest dev.to articles" || echo "No changes to commit"
          git push
